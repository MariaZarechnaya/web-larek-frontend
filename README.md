# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Схема структуры приложения
![Схема структуры приложения](./схема%20для%20документации.png)
## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемых в приложении. 

 Данные одной карточки:
 ```
interface ICard {
    id: string,
    category: string;
    name: string;
    text:string;
    link:string;
    price:number;
}
``` 

 Тип для выбора оплаты:
 ```
type Pay = 'Онлайн'| 'Наличные'
```
Данные пользователя, используемые для оформления заказа:
```
interface IUser {
    paymentType: Pay;
    adress:string;
    email:string;
    phone:string;
}
``` 
Коллекция карточек: 
```
interface ICardList  {
    total:number;
    cards: ICard[]  
    preview: string | null 
}
``` 
Коллекция для хранения товара(карточек) в корзине:
```
interface IBacket {
    items: Map <string, number>
    sum:number
}
``` 
Данные карточки, добавленной в корзину
```
type basketCard = Pick <ICard,"id"|"name"|"price">  
``` 
Данные, необходимые для превью на главной странице
```
type previewCard = Pick <ICard, "category"|"name"| "link"|"price" >
```

## Архитектура приложения
Приложение написано на базе архитектуры MVP. MVP разделяет приложение на три основных компонента:
1. Модель (Model): Модель представляет собой бизнес-логику приложения и данные. Она ответственна за выполнение операций, таких как чтение и запись данных, обработка бизнес-логики и взаимодействие с базой данных или внешними источниками данных.
2. Представление (View): Представление отображает данные пользователю и обрабатывает пользовательский ввод. Оно представляет собой интерфейс пользователя, через который пользователь взаимодействует с приложением.
3. Презентер (Presenter): Презентер является посредником между моделью и представлением. Он содержит бизнес-логику приложения и управляет взаимодействием между моделью и представлением. Презентер получает данные от модели, форматирует их и передает представлению для отображения. Он также обрабатывает пользовательский ввод, передавая соответствующие команды модели для обновления данных.


## Базовый код
### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий. \
\
 Класс имеет методы:
* `on` - подписка
*  `off` - отписка
*  `emit`  —  уведомления подписчиков о наступлении события соответственно.Инициализация событий
Дополнительно реализованы методы  onAll и  offAll  — для подписки на все события и сброса всех
подписчиков.
Интересным дополнением является метод  trigger , генерирующий заданное событие с заданными
аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. 
### Класс API
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Поля:
- baseUrl: string - ссылка для запроса
- options: RequestInit - опции, передаваемые в параметры запроса
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

## Cлой данных
### класс CardData
Класс отвечает за хранение и логику работы с карточкой. Хранит в себе данные одной карточки и методы для работы с ней\
\
В полях класса хранятся следующие данные:
- id: string - id карточки
- category?: string - категория товара 
- name: string - название
- text?: string - описание товара
- link?: string - ссылка на изображение
- price: number - стоимость
-  events: IEvents - экземпляр класса `EventEmitter` для инициации событий \
\
Класс так же содержит методы:

- getCard (id:string):ICard- возвращает карточку по ее id

 ### Класс UserData
 Класс отвечает за хранение и логику работы с данными, необходимыми для заказа\
 \
 В полях класса хранятся следующие данные: 
- paymentType: Pay - тип оплаты
-  adress: string - адрес
-  email: string - адрес электронной почты
- phone: string  - номер телефона получателя
-  events: IEvents - экземпляр класса `EventEmitter` для инициации событий

Класс имеет следующий набор методов:

*  validateUserPayAdress (data:IUser):boolean  - валидация данных поля с адресом
*  validateUserContacts (data:Iuser):boolean - валидация данных полей с контактными данными (телефон, почта)
*  а так-же сеттеры и геттеры для сохранения и получения данных из полей класса
    
### класс CardList
Класс отвечает за хранение и логику работы с коллекцией карточки.\
Конструктор класса принимает инстант брокера событий\
\
В полях класса хранятся следующие данные:
- cards: ICard[] - массив объектов карточек
 - total:number - максимальное количество карточек которое можем вывести
- preview: string | null - id карточки, выбранной для просмотра в модальной окне
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Класс имеет следующий набор методов:
 - getCard (id:string):ICard- возвращает карточку по ее id


### Класс BasketData
Отвечает за хранение данных корзины и методы работы с ними \
\
Поля класса:
- items: Map <string, number> - коллекция из неповторяющихся данных 
- sum:number - поле хранит сумму заказа

Методы класса:

- add (id:string, price:number):void - добавить в коллекцю корзины 
- remove (id:string):void - удалить из корзины 
- setSumm ():void  - метод устанавливает сумму в корзине
- getSumm ():void -  получить сумму



## Представление
### Базовый Класс Component
Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.\
\
Интерфейс, описывающий объект с разметкой для вставки в модальное окно
```
interface IModalData {
    content: HTMLElement;
}
```
Поля класса:
- content: HTMLElement - контейнер для вставки
- events: IEvents - брокер событий 
- closeButton: HTMLButtonElement - кнопка закрытия
- render(data: IModalData): HTMLElement - метод будет возвращать элемент модального окну с установленной разметкой
- сеттер set content(value: HTMLElement) - для установки контента 

Конструктор:
- constructor(container: HTMLElement events: IEvents) -  принимает элемент  модального окна и экземпляр класса `EventEmitter` для возможности инициации событий.

Методы класса:
- open():void - метод для открытия модального окна
- close():void  - метод для закрытия модального окна. Так же обнуляет разметку и удаляет обработчики событий с разметки через this.content = null
- handleEsc(event):void  - закрытие по кнопке esc
- render():HTMLElement - отрисовка разметки для модального окна
- сеттер set content - вставляет контент в контейнер модального окна

### Класс CardView
Отвечает за отображение карточки, задавая в карточке данные названия товара, категории, изображения, стоимости, описания товара. Класс используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент темплейта. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.

Поля:
   - cardId: string - поле хранит id, необходимое для идентификации карточки
   - cardCategory: HTMLElement - отображение категории
   - cardTitle: HTMLElement - название
   - cardText: HTMLElement - описание
   - cardImage:HTMLDivElement - картинка
  -  cardPrice:HTMLElement -  стоимость
   - cardRemoveButton?:HTMLButtonElement - кнопка "убрать из корзины"
   - cardAddButton:HTMLButtonElement - кнопка "добавить в корзину"
   - events:IEvents - брокер событий

   Конструктор:
- constructor(container: HTMLElement, events: IEvents) -  принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.
   
Методы:

- render(data:ICard):HTMLElement - отображение списка корзины
- addToBasket ():void - добавить в корзину
-  removeFromBasket ():void - убрать из корзины
-  showInfo():void - отвечает за отображение полной информации у карточки


### Класс CardsContainer
Отвечает за отображение блока с карточками на главной странице. В конструктор принимает контейнер, в котором размещаются карточки. В метод render принимает массив элементов разметки карточек, который отображает в контейнере, за который отвечает.

Поля класса
 - container: HTMLElement  -  контейнер куда будут рендериться карточки

 Конструктор:
- constructor (container:HTMLElement)

Методы:
- render (data:ICard[]): HTMLElement - отвечает за вывод карточек

### Класс BasketView
Отвечает за отображение списка товаров, добавленных в корзину

Поля класса:
- list: HTMLElement - контейнер для рендеринга
- items: HTMLElement[] - массив товаров, добавленных в корзину
- totalSumm: HTMLElement -  вывод общей стоимости товаров
- buttonOrder: HTMLElement -  кнопка оформления заказа

Конструктор:
- constructor(container:HTMLElement, events: IEvents)- в конструктор принимает контейнер, куда выводится список товаров

Методы:

- сеттеры для заполнения элементов разметки корзины 

### Класс CardBasketView
Класс, отвечающий за отображение элемента карточки товара в корзине
Поля класса:
- cardId: string - поле, в котором хранится id карточки
- cardTitle: HTMLElement - поле с названием товара
- cardPrice:HTMLElement - со стоимостью товара
- cardRemoveButton:HTMLButtonElement - кнопка удаления товара из корзины
- events:IEvents - брокер событий

Конструктор:
- constructor( container: HTMLElement, events: IEvents) - принимает в себя контейнер, в котором будут отображаться элементы карточки

Методы:
- сеттеры для заполнение разметки
- геттер для возврата id карточки

### класс Form
Является родительским классом для всех форм в приложении. Содержит общие методы для форм. Наследуется от Component

Интерфейс состояния формы:
```
interface IFormState {
    valid: boolean;
    errors: string[];
}
```

Поля класса:
- submit: HTMLButtonElement - кнопка сабмита
- errors: HTMLElement - поля с ошибками

Конструктор:
- constructor(container: HTMLFormElement,  events: IEvents) 
Методы:
- onInputChange(field: keyof T, value: string) - реакция на события инпутов формы
- set valid(value: boolean) - устанавливает валидность формы
- set errors(value: string)  - устанавливает ошибки
- render(state: Partial<T> & IFormState) - возвращает элемент формы с наполнением


### Класс Confirm 
Окно успешного  подтверждения заказа
- close: HTMLElement - элемент закрытия

Конструктор:
- constructor(container: HTMLElement, actions: IEvent) - принимает в кончтруктор элемент разметки и брокер событий
## Слой коммуникации

### Класс LarekApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.
Методы: 
-  getCardList(): Promise<ICard[]> - возвращает массив данных карточек 
- getCard (): Promise<ICard> - запрос данных одной карточки
- setUserInfo(data: IUser) - отправка данных заказа

### Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в index.ts
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.
Так же в файле инициированы шаблоны разметки

*Список всех событий:*
- `cards:show` - показать массив карточек
- `card:open` - открытие модального окна с карточкой
- `card:addToBasket` - добавить товар в корзину
- `card:removeFromBasket` - выбор карточки для удаления из корзины
- `basket:open` - открытие модального окна c корзиной
- `basket:order` - оформить заказ
- `order:payType` - выбор способа оплаты
- `order:change` - записать данные заказа
- `order:submit` - отправка данных заказа 
- `order-user-data:input` - изменение данных в форме с данными пользователя
- `edit-user-data:validation` - событие, сообщающее о необходимости валидации формы данных пользователя
- `next-user-data:submit` - событие, генерируемое кнопкой "далее" при заполнении форм
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
